<?xml version="1.0" encoding="UTF-8"?>

<chapter xml:id="ch3-malware" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Malware</title>

				<section xml:id="what-is-malware">
					<title>3.1 What is malware?</title>
					<p>
						<idx>malware</idx>
						<term>Malware</term> is a portmanteau of the words 
						<em>malicious</em> and 
						<em>software</em>. The term is used to describe many different types of 
						<em>intentionally malicious</em> programs. One of the key differences between malware and just plain bad software is the intentional aspect of its creation. Malware is designed to damage or exploits computer systems. It often spies on, spams, or otherwise damages target or host machines.
					</p>
				</section>
				
				<section xml:id="malware-targets">
					<title>3.2 Malware Targets</title>

					<figure xml:id="fig-malware-distribution">
						<caption>Figure 3.2.1. malware</caption>
						<image source="malware.png">
                        <shortdescription>A bar chart illustrating malware detections by platform, with Windows being the most targeted.</shortdescription>
                        <description>
							<p>This bar chart displays the percentage of malware detections across different platforms. Windows is overwhelmingly the primary target, accounting for approximately 83% of detections. Web browsers are the second most common target at around 11%. Android follows with about 3% of detections, and all other platforms combined make up the remaining 1-2%. The y-axis represents the "Percentage of Malware Detections" ranging from 0 to 90, and the x-axis lists the platforms: Windows, Browser, Android, and Other.</p>
						</description></image></figure>

					<p>
					Malware Distribution by OS (Q1 2020)^[
						<url href="index.html#_footnotedef_4">4</url>{#_footnoteref_4 .footnote}]^
				
					</p>

					<p>
					The most popular target for malware is the Windows OS by quite a large margin. This is due largely to its popularity as a desktop operating system. The second largest target is web browsers, which afford malware a unique cross-platform reach. The third largest target is the Android mobile operating system, which while technically Linux runs mostly on mobile phones. Both Linux and Mac do not receive as much malware attention. While this may be partially due to the open-source nature of Linux and the BSD kernel used by Macs, it is also partially due to the lack of popularity of each of these operating systems. Malware is often widely distributed, meaning it can target only the most popular/possibly weakest links and still be successful.
				</p>

		<subsection xml:id="zero-days"> <title>Zero Days</title>
			<p>
			<idx>zero days</idx>
				Modern operating systems employ layers of security to ensure that programs do not have access to sensitive information or applications. This typically means that for malware to be effective, it needs to elevate its privileges. The most effective malware can perform privilege escalation without requiring user interaction. To do this malware may rely on new/undocumented exploits or vulnerabilities. These new exploits that have been disclosed for "zero days" are hence are referred to as <term>zero days</term>. Zero days are incredibly powerful and may be hoarded by APTs/criminal groups or sold for millions of dollars on the Dark Web.
			</p>
		</subsection>
	</section>
				
	<section xml:id="types-of-malware">
	<title>3.3 Types of Malware</title>
		<p>
			The definition of malware is so broad and new malware is being created daily. This can make it difficult to classify malware. As we go through some basic types, please keep in mind that there is significant overlap. For example, you may encounter ransomware distributed as a virus 
			<em>or</em> ransomware distributed as a trojan. The fact that it is ransomware does not preclude it from being some other type of malware as well.
				

		</p>
		
		<subsection xml:id="worms-viruses-and-trojans-_worms_viruses_and_trojans">
			<title> Worms, Viruses, and Trojans</title>
			<p>
				Worms are self-propagating programs that spread without user interaction. Their code is typically stored within an independent object, such as a hidden executable file. Worms often do not severely damage their host, as they are concerned with rapid, exponential spreading.
			</p>
			<example xml:id="example-stuxnet"> <title>Stuxnet</title>
				<p>
					Stuxnet was a 2010 worm that specifically targeted Iranian nuclear facilities. The worm used an unprecedented four zero-day attacks and was designed to spread via USB flash drives and Remote Procedure Calls (RPCs). In this way it didn’t just rely on networks to propagate. Ultimately Stuxnet’s payload targeted the code used to program PLC devices that control motors and make them spin too fast, destroying the centrifuges. Stuxnet also employed an impressive rootkit to cover its tracks. Given the level of sophistication Stuxnet is believed to have been developed by the US and Israel.
				</p>
			</example>
			<p>
				Viruses typically require user interaction, such as copying and infected file from one machine to another, and store their code inside another file on a machine. An executable file may be infected by having the virus code added a separate page that executes before the standard program code. Viruses can be quite damaging to the host as they may take significant resources to spread locally. The term virus is also an unfortunately overloaded one. Due to it’s popularity it is often used by some lower-skill threat actors to refer to many different types of malware.
			</p>
			<example xml:id="example-concept-virus"> <title>Concept Virus</title>
				<p>
					The Concept virus was the first example of a Microsoft Word macro virus. The virus hid itself inside Microsoft Word files and used Word’s embedded macro language to perform its replication tasks. Viruses were later created for Excel and other programs that had sufficiently sophisticated yet ultimately insecure internal scripting languages.
				</p>
			</example>
			<p>
				A trojan is a form of malware that disguises itself as legitimate software. It does not have to rely on a software exploit as much as it exploits users into installing, running, or giving extra privileges to the malicious code. Trojans are the most popular kind of malware as they can be used as an attack vector for many other payloads. The name comes from Greek mythology, where a Trojan horse was disguised as a gift and given to a besieged town. Within the large horse were secret troops who came out in the middle of the night and opened the town gates.
			</p>
			<example xml:id="example-emotet"> <title>Emotet</title>
				<p>
					Emotet is a banking trojan from 2014 that spread through emails. It made use of malicious links or macro-enabled documents to make the user download its code. Emotet has been one of the most costly and destructive pieces of malware currently averaging about one million in incident remediation. It continues to be adapted to avoid detection and make use of even more sophisticated malware.
				</p>
			</example>
		</subsection>

		<subsection xml:id="ransomware-_ransomware">
			<title> Ransomware</title>
			<figure>
				<image source="wannacry.png"/>
				<caption>wannacry</caption>
			</figure>
			<p>
				<url href="https://en.wikipedia.org/wiki/File:Wana_Decrypt0r_screenshot.png">Wana Decrypt0r screenshot</url> is used under fair use
			</p>
			<p>
				Ransomware is a type of malware that encrypts files and demands a ransom to decrypt them. Modern ransomware uses symmetric encryption to the files quickly and then encrypts the symmetric key asymmetrically using a hard-coded public key for which the threat actor has the corresponding private key. When the ransom is paid, typically via cryptocurrency, the threat actor can decrypt the symmetric key using their private key and the user can use the symmetric key to decrypt the files.
			</p>
			<p>
				Ransomware is considered a data breach in the data is often exfiltrated as well. It is also worth noting that when the ransom is paid, there is no guarantee that the threat actor will actually begin the decryption process. Typical targets of ransomware include corporate infrastructure and health care systems although ransomware may also be spread indeterminately. The payout of ransoms can be a large money-making enterprise so many APTs or criminal groups may employ its use. Ransomware is considered the biggest threat to cyber stability today.
			</p>
		</subsection>
					
		<subsection xml:id="spyware-_spyware">
			<title>Spyware</title>
			<p>
				Malware specifically designed for espionage/data theft is known as spyware. Like ransomware, spyware can also have a monetary payoff for the threat actor. Actors may use extortion to demand payment or the data will be 
				<em>leaked</em>. This typically means either sold on the dark web or publicly posted. Once again, given the possibility of monetary gain, spyware is often associated with criminal groups. APTs may use spyware as well to obtain secrets of national importance.
			</p>
			<p>
				Customer data, trade secrets, proprietary data, and government secrets are all targets of spyware. Even outside of governments systems, in the corporate setting, spyware is still a major threat.
			</p>
			<sidebar> <title>Fileless Malware</title>
				<figure>
					<image source="fileless.svg"/>
					<caption>fileless</caption>
				</figure>
				<p>
					Malware is often detected by scanning storage for files that match a particular hash or by looking in files to see if they contain patterns. Both of these detection techniques rely on the malware being stored in a file. Fileless malware attempts to avoid detection by leaving no footprint in the file system. This type of malware uses legitimate processes to load itself into memory, often with a registry key created to reload every time the machine is restarted. This creates a persistent, hard-to-detect type of malware that is often used by sophisticated threat actors such as APTs and criminal groups.
				</p>
			</sidebar>
		</subsection>
					
		<subsection xml:id="cryptojacking-_cryptojacking">
			<title>Cryptojacking</title>
			<p>
				Crypto currencies utilizing proof-of-work algorithms have made it easier than ever for programs to convert processor cycles into money. Certain types of malware capitalize on this by mining cryptocurrency in the background on a users machine. This theft of power and resources can result income for the malware distributor when the funds from mining are deposited into their online wallet.
			</p>
			<p>
				Cryptojacking is more popular than ever, especially considering that large botnets of infected machines have already been created. Cryptojacking creates a simpler path to monetization for malicious actors who may already have control of many compromised machines.
			</p>
		</subsection>
		
		<subsection xml:id="rootkit-_rootkit">
            <title>Rootkit</title>
            <figure>
                <image source="rootkit.svg"/>
                <caption>rootkit</caption>
            </figure>
            <p>
                A rootkit is a secret program designed to give back door access to a system. They are designed to remain hidden and may even actively disable or circumvent security software. Due to their low-level nature, many rootkits can be difficult to detect and even more difficult to remove.
            </p>
            <p>
                Rootkits are often classified in accordance with the layer in which they are hidden:
            </p>
            <subsubsection>                     
                <title>Firmware Rootkit</title>
                <p>
                    Firmware is code that a hardware device uses to run. It is often a thin layer of commands used for setting up and interfacing with the device. A firmware rootkit may reside in the BIOS of a motherboard and can be very difficult to remove.
                </p>
                </subsubsection>
                
            <subsubsection>
                <title>Bootloader Rootkit</title>
                <p>
                    A bootloader prepares the system to boot an operating system kernel, typically by loading the kernel into memory. A bootloader rootkit may hijack this process to load itself into separate memory space or manipulate the kernel being loaded.
                </p>
            </subsubsection>

            <subsubsection>
                <title>Kernel-mode Rootkit</title>
                <p>
                    Many operating system kernel, including Linux, have the ability to load dynamic modules. These kernel modules have complete access to OS kernel operations. A kernel-mode rootkit can be difficult to detect live as the OS kernel being given the instructions to detect the rootkit can no longer be trusted.
                </p>
            </subsubsection>

            <subsubsection>
                <title>Application Rootkit</title>
                <p>
                    An application or user-mode rootkit is usually installed as an application that runs in the background with administrative privileges. These rootkits are typically the easiest to develop and deploy, a low-level knowledge of the hardware the system is using is not required, but they are also the easiest to detect and remove.
                </p>
            </subsubsection>
        </subsection>
        -->
        -->
        -->
        -->
        -->
        -->
        -->
        <example xml:id="example-sony-rootkit">
            <title>Sony Rootkit</title>
            <p>
                In 2005 Sony released CDs for their music software with an application rootkit designed to run on Microsoft Windows systems. The rootkit ran persistently in the background, slowing systems, and did not have an uninstaller to remove the program. It was designed to prevent the OS from copying information from audio CDs, but it also opened up several security holes that could be exploited by other malware. Ultimately the rootkit led to several class-action lawsuits against Sony BMG and a led to a settlement with the Federal Trade Commission that required Sony to reimburse customers who reported damages from the rootkit.
            </p>
        </example>

        <subsection xml:id="botnet-_botnet">
            <title> Botnet</title>
            <p>
                A botnet is a network of exploited hosts controlled by a single party. These hosts may be desktop computers, servers, or even internet of things (IoT) devices. Botnets are often used in large-scale distributed denial of service (DDoS) attacks where the nature of the attack is to have many machines flooding a single machine with traffic. Botnets may also be used to send spam emails as their access to SMTP email relay may vary depending on their internet service provider (ISP).
            </p>
            <p>
                Bots are typically controlled through a command and control (C2, C&amp;C) server. While this C2 server may use a custom protocol, it is far more typical for modern botnets to rely on other infrastructure. C2 traffic can use SSH, HTTP, Internet Relay Chat (IRC), or even Discord to send commands to bots and receive data from bots.
            </p>
            </subsection>
        <subsection xml:id="rat-_rat">
            <title>RAT</title>
            <p>
                RAT stands for Remote Access Trojan an it is used to gain full access and control of a remote target. The malware distributor can browse the files on a computer, send keystrokes and mouse movements, view the screen, and/or monitor the input from the microphone and camera. RATs often actively bypass security controls and as such they may be difficult to detect.
            </p>
            </subsection>
        <subsection xml:id="adware-potentially-unwanted-programs-pup-_adware_potentially_unwanted_programs_pup">
            <title> Adware / Potentially Unwanted Programs (PUP)</title>
            <p>
                Adware is malware that is designed to track user behavior and deliver unwanted, sometimes intrusive, tailored ads. Adware may slow down a system and/or add ad walls to sites. This type of malware often targets a users web browser.
            </p>
            <p>
                Potentially Unwanted Programs (PUP) are typically downloaded as part of the install of another program. Commons PUPs are browser toolbars, PDF readers, compression utilities, or browser extensions. These programs may have adware/spyware components in them and can also slow down a system.
            </p>
            </subsection>
    </section>

				<section xml:id="indicators-of-compromise">
					<title>3.4. Indicators of Compromise</title>
					<!-- div attr= class="paragraph"-->
					<p>
					An 
						<em>indicator of compromise (IoC)</em> is an artifact with high confidence the indicates an intrusion. It is a way to tell if a machine has been a victim of malware. IoCs are publicly communicated by security professionals in an effort to help mitigate the effects of malware.
				
					</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="dlist"-->
					<!-- div attr= class="title"-->
					<p>
					Common IoC Types
				</p>
					<!--</div attr= class="title">-->
					<dl>
						<dt>Hash</dt>
						<dd>
							<p>
					A hash of files that are known to be malicious. This can help in identifying trojans and worms.
				</p>
						</dd>
						<dt>IP addresses</dt>
						<dd>
							<p>
					Tracking the IP addresses which malware connects to can be used to determine if a machine is infected.
				</p>
						</dd>
						<dt>URLs/Domains</dt>
						<dd>
							<p>
					Tracking the URLs or domains that malware uses can also be used to determine if a machine is infected.
				</p>
						</dd>
						<dt>Virus definition/signature</dt>
						<dd>
							<p>
					Executables and other files can be scanned for specific sequences of bytes which are unique to a particular virus. In this way even if the malware is hiding within another file, it can still be detected.
				</p>
						</dd>
					</dl>
					<!--</div attr= class="dlist">-->
					<!--</div attr= class="sect2">-->
					<!-- div attr= class="sect2"-->
				</section>
				<section xml:id="delivery-of-malware">
					<title>3.5. Delivery of Malware</title>
					<!-- div attr= class="paragraph"-->
					<p>
					Malware is often delivered through social engineering, namely convincing an actor within an organization to download and run or click on something. It can also delivered through infiltrating the software packages something depends on, supply chain, or possibly through a software exploit on an publicly exposed service. Some of the most common ways of spreading malware are detailed below.
				</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="sect3"-->
					<paragraphs xml:id="phishing">
						<title>3.5.1. Phishing</title>
						<!-- div attr= class="paragraph"-->
						<p>
						Phishing involves communicating with someone via a fraudulent message in an effort to make them perform and action that will harm them. It is broken into five main categories:
					</p>
						<!--</div attr= class="paragraph">-->
						<!-- div attr= class="dlist"-->
						<dl>
							<dt>Spear phishing</dt>
							<dd>
								<p>
						Sending phishing emails or other communications that are targeted towards a particular business or environment. These messages may include information about the inner workings of the organization in an attempt to prove their validity. They may also take advantage of a known, insecure practice at a particular organization. Spear phishing is not your standard wide-net phishing attempt, but more of a focused, tailored, custom campaign.
					</p>
							</dd>
							<dt>Whaling</dt>
							<dd>
								<p>
						Targeting high-ranking individuals at an organization. Whaling is often used in conjunction with spear phishing.
					</p>
							</dd>
							<dt>Smishing</dt>
							<dd>
								<p>
						Using SMS messages when phishing.
					</p>
							</dd>
							<dt>Vishing</dt>
							<dd>
								<p>
						Using voice messages when phishing.
					</p>
							</dd>
							<dt>Phishing sites</dt>
							<dd>
								<p>
						Threat actors can attempt to gain unauthorized access through information obtained from non-business related communication channel. For example, malicious actors may know that the CEO frequents a popular sailing forum. These actors could set up an account on the sailing forum to direct message the CEO for information.
					</p>
							</dd>
						</dl>
						<!--</div attr= class="dlist">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="spam">
						<title>3.5.2. SPAM</title>
						<!-- div attr= class="paragraph"-->
						<p>
						SPAM consists of large quantities of unsolicited emails. These emails may be malicious or they may simply be advertising. In either case SPAM accounts for nearly 85% of all email. It is interesting to note that sometimes the malware distributed through SPAM is actually used to send more SPAM through a victim’s machine. The war on SPAM is constantly evolving and while many updates have been made to the way we send email, many improvements have yet to be realized.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="dumpster-diving">
						<title>3.5.3. Dumpster Diving</title>
						<!-- div attr= class="paragraph"-->
						<p>
						Information that can ultimately lead to the spread of malware can also be found in improperly disposed trash. Old records or hard drives may contain corporate secrets or credentials that give someone unauthorized access. It is important to properly dispose of sensitive information, making sure that all things that need to be destroyed are destroyed in a complete manner.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="shoulder-surfing">
						<title>3.5.4. Shoulder Surfing</title>
						<!-- div attr= class="paragraph"-->
						<p>
						PINs, passwords, and other data can also recovered simply by looking over someone’s shoulder. These credentials could be the "in" that an attacker needs to spread malware. Through the aid of optics, such a binoculars, shoulder surfing can even occur at a long distance. Privacy screens, which limit the angle at which you can see a monitor, can be helpful in mitigating this type of attack.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="tailgating">
						<title>3.5.5. Tailgating</title>
						<!-- div attr= class="paragraph"-->
						<p>
						Following behind someone who is entering a secure location with a credential is known as tailgating. Often people will even hold secure doors open for someone if they have their hands full. It is human nature to want to help people, but you also must remember that the person behind you may have a USB key with malware ready to deploy as soon as they gain physical access to a machine in the building.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="impersonationidentity-theft">
						<title>3.5.6. Impersonation/Identity Theft</title>
						<!-- div attr= class="paragraph"-->
						<p>
						Often as part of a phishing campaign, a threat actor will pretend to be someone else. This may be someone within the organization or someone with sufficient power outside the organization, such as a representative of a government oversight agency. Attackers may also use stolen credentials to make their messages appear official, once again giving them and easy route through which to deploy malware.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!--</div attr= class="sect2">-->
						<!-- div attr= class="sect2"-->
					</paragraphs>
				</section>
				<section xml:id="cyber-killchain">
					<title>3.6. Cyber Killchain</title>
					<!-- div attr= class="imageblock text-center"-->
					<!-- div attr= class="content"-->
					<figure xml:id="fig-cyber-killchain">
					<caption>killchain</caption>
					<image source="killchain.svg">
						<shortdescription>A diagram illustrating the seven stages of the Cyber Kill Chain model developed by Lockheed Martin.</shortdescription>
						<description>
							<p>This diagram visually represents the seven distinct phases of the Cyber Kill Chain model, a framework developed by Lockheed Martin to describe the stages of a cyberattack. The typical stages shown sequentially are: 1. Reconnaissance (attacker gathers information about the target), 2. Weaponization (attacker creates a malicious payload), 3. Delivery (attacker transmits the weapon to the target), 4. Exploitation (weapon's code is triggered, exploiting a vulnerability), 5. Installation (malware establishes persistence on the victim system), 6. Command and Control (C2) (malware enables the attacker to remotely control the compromised system), and 7. Actions on Objectives (attacker achieves their goals, such as data exfiltration or system disruption). The diagram usually depicts these stages in a linear progression, often using chevrons or connected blocks.</p>
						</description>
					</image>
				</figure>
					<!--</div attr= class="content">-->
					<!--</div attr= class="imageblock text-center">-->
					<!-- div attr= class="paragraph"-->
					<p>
					One way of analyzing an attack involving malware is through the steps of the Cyber Killchain. The Cyber Killchain was developed by Lockheed Martin and is a military method of analysis that has been adopted by cybersecurity. Cyber Killchain is broken into seven steps: Recon, Weaponization, Delivery, Exploitation, Installation, Command and Control, and Exfiltration.
				</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="sect3"-->
					<paragraphs xml:id="recon">
						<title>3.6.1. Recon</title>
						<!-- div attr= class="paragraph"-->
						<p>
						Recon is short for reconnaissance, military parlance for a preliminary survey used to gain information. During the recon phase, a malicious actor will gather as much information as possible. Methods used in this phase may be passive or active.
					</p>
						<!--</div attr= class="paragraph">-->
						<!-- div attr= class="paragraph"-->
						<p>
						Passive recon involves gathering information 
							<em>without</em> sending anything to the target. This typically involves accessing publicly available information, such as social media, published websites, and DNS records. If the actor has access they may also passively sniff network packets.
					
						</p>
						<!--</div attr= class="paragraph">-->
						<!-- div attr= class="paragraph"-->
						<p>
						Active recon involves interaction with the target. This can include port scanning, vulnerability scanning, 
							<url href="https://www.kali.org/tools/dirbuster/">brute forcing directories and filenames on an HTTP server</url>, or even contacting workers. Active recon can yield more information, but it is also significantly easier to detect.
					
						</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="weaponization">
						<title>3.6.2. Weaponization</title>
						<!-- div attr= class="paragraph"-->
						<p>
						In the weaponization phase the actor begins readying exploits for the vulnerabilities that were assessed during recon. This may include tailoring malware, creating phishing emails, customizing tools, and preparing an environment for the attack. For malware to be effective it must utilize the correct exploits and work under the correct OS and environment. 
							<url href="https://www.metasploit.com/">Metasploit</url> is a penetration testing framework that is often used in this step to create custom malware.
					
						</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="delivery">
						<title>3.6.3. Delivery</title>
						<!-- div attr= class="paragraph"-->
						<p>
						During the delivery phase the malware is handed over to the target. Typically steps are taken to bypass detection systems. Delivery may involve the sending of emails linked to malware or the exploitation of vulnerable servers to then run malware. At the end of this phase, an attacker typically waits for a callback from the malware via the command and control channel.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="exploitation">
						<title>3.6.4. Exploitation</title>
						<!-- div attr= class="paragraph"-->
						<p>
						Technically the exploitation step occurs once the malware is successfully executed. In many cases, this involves almost no interaction from the attacker. Once malware is activated or the payload of an exploit executed, the 
							<em>victim</em> has completed the exploitation step.
					
						</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="installation">
						<title>3.6.5. Installation </title>
						<!-- div attr= class="paragraph"-->
						<p>
						The installation step is typically performed by the malware once it is running. The malware installs itself, hides itself, and sets up persistence (the ability to restart after being stopped). The malware may escalate privilege or move laterally. It may also install second stage additional payloads from a remote server. A common tactic is injecting downloaded code into an existing process to mask which process is performing questionable actions.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="command-and-control-c2-cc">
						<title>3.6.6. Command and Control (C2, C&amp;C)</title>
						<!-- div attr= class="paragraph"-->
						<p>
						Malware will reach out via its Command and Control channel for more instructions. At this point an attacker may interact with the malware, giving it additional commands. C2 traffic is usually designed to blend in with existing traffic and not draw attention.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!-- div attr= class="sect3"-->
					</paragraphs>
					<paragraphs xml:id="exfiltration-actions-objectives">
						<title>3.6.7. Exfiltration / Actions &amp; Objectives</title>
						<!-- div attr= class="paragraph"-->
						<p>
						The final step involves getting data from the exploited systems or disabling/misusing the systems in another way. At this point an attacker can use the C2 channel to pull sensitive information from the system, credit card information, password hashes, etc. Its important to not that exfiltration of data may not be the only goal of the attack. An attacker can also disable the system, commit fraud with the system, mine crypto currencies, etc. At this point the malicious actor is in complete control of the exploited system.
					</p>
						<!--</div attr= class="paragraph">-->
						<!--</div attr= class="sect3">-->
						<!--</div attr= class="sect2">-->
						<!-- div attr= class="sect2"-->
					</paragraphs>
				</section>
				<section xml:id="lab-malware-analysis">
					<title>3.7. Lab: Malware Analysis</title>
					<!-- div attr= class="paragraph"-->
					<p>
					The website 
						<url href="https://any.run">Any Run</url> offers free interactive malware analysis. We will be using this site to avoid the complications of running malware in a VM.
				
					</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="paragraph"-->
					<p>
					Start by visiting 
						<url href="https://any.run">Any Run</url> and registering for an account with your NJIT email address. Once you have activated your account via email, follow the tutorial to learn how to analyze threats. Use the demo-sample task provided by Any Run. Follow the prompts and watch how the process tree changes. Feel free to take your time, even after the time expires you will still be able to look at the running processes and analyze HTTP Requests, Connections, DNS Requests, and Threats.
				
					</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="paragraph"-->
					<p>
					For this lab we are going to look at an example of 
						<url href="https://www.malwarebytes.com/emotet">Emotet</url>, a banking Trojan discovered in 2014. On the left-hand side of the Any Run site, click on 
						<em>Public tasks</em> and search for the md5 sum 
						<c>0e106000b2ef3603477cb460f2fc1751</c>. Choose 
						<em>one</em> of the examples (there are three) and look through the screenshots to get an idea of how the malware is run. It may also help to glance at the network traffic processes.
				
					</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="paragraph"-->
					<p>
					Run the VM live by clicking 
						<em>Restart</em> in the upper right-hand corner. Perform the actions necessary to trigger the malware, adding time as needed. Finally open notepad on the VM, type in your name, and take a unique screenshot.
				
					</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="admonitionblock important deliverable"-->
					<p>
					+———————————–+———————————–+ | | ::: {.paragraph} | | | Submit a unique screenshot of | | | your VM | | | ::: | +———————————–+———————————–+
				</p>
					<!--</div attr= class="admonitionblock important deliverable">-->
					<!-- div attr= class="paragraph"-->
					<p>
					Use the Any Run tools to analyze the malware you chose.
				</p>
					<!--</div attr= class="paragraph">-->
					<!-- div attr= class="admonitionblock important deliverable"-->
					<p>
					+———————————–+———————————–+ | | ::: {.paragraph} | | | Answer the following questions in | | | the text box provided: | | | ::: | | | | | | ::: {.qlist .qanda} | | | 1. 
						<em>What does this malware do to | | | ensure that it is always | | | running in the background?</em> | | | | | | 2. 
						<em>Why is malware often put | | | inside an archive file | | | instead of being distributed | | | as a simple executable?</em> | | | | | | 3. 
						<em>What IP addresses does this | | | malware attempt to connect | | | to?</em> | | | | | | 4. 
						<em>Does this malware resolve | | | any DNS addresses? How do you | | | know?</em> | | | | | | 5. 
						<em>How could you uniquely | | | identify this file as malware | | | (be specific, like specific | | | enough for a malware scanner | | | to find it)?</em> | | | | | | 6. 
						<em>What are IoCs and what are | | | the IoCs for this malware?</em> | | | ::: | +———————————–+———————————–+
				
					</p>
					<!--</div attr= class="admonitionblock important deliverable">-->
					<!--</div attr= class="sect2">-->
					<!-- div attr= class="sect2"-->
				</section>
				<section xml:id="malware_review">
					<title>3.8. Review Questions</title>
					<!-- div attr= class="qlist qanda"-->
					<p>
						<ol>
							<li>
								<p>
									<em>Why might an APT choose to use fileless malware as opposed to malware that runs from a file on a machine?</em>
								</p>
							</li>
							<li>
								<p>
									<em>What is an IoC? Give an example.</em>
								</p>
							</li>
							<li>
								<p>
									<em>What is phishing? What are the five types of phishing? Give an example of each type.</em>
								</p>
							</li>
						</ol>
					</p>
					<!--</div attr= class="qlist qanda">-->
					<!--</div attr= class="sect2">-->
					<!--</div attr= class="sectionbody">-->
					<!--</div attr= class="sect1">-->
					<!-- div attr= class="sect1"-->
				</section>

</chapter>
